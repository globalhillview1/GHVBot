<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sign in · Global Hillview, Enviro Helpdesk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="https://drive.google.com/uc?export=view&id=1opE1H0_mWwguRjSaDlGPPVV3wN8Pn2jM" />
  <style>
    :root{--card:#fff;--bg:#f7f9fc;--text:#0f172a;--muted:#6b7280;--border:#e5e7eb;--blue:#0d6efd;--danger:#ef4444}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;background:var(--bg);color:var(--text)}
    .wrap{min-height:100vh;display:grid;place-items:center;padding:24px}
    .card{width:100%;max-width:560px;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:28px 28px 22px}
    h1{margin:10px 0 4px;font-size:28px} .muted{color:var(--muted)}
    .row{margin:14px 0} label{display:block;font-size:13px;margin:0 0 6px;color:var(--muted)}
    input{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:12px;font-size:15px}
    .btn{width:100%;padding:12px 16px;background:var(--blue);color:#fff;border:none;border-radius:12px;font-weight:700;cursor:pointer}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .err{display:none;margin-top:14px;padding:10px;border-radius:10px;background:#fee2e2;color:#7f1d1d;border:1px solid #fecaca}
    .spinner{display:inline-block;width:14px;height:14px;border:2px solid currentColor;border-right-color:transparent;border-radius:50%;animation:spin .8s linear infinite;vertical-align:-2px;margin-left:8px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .brand{display:flex;align-items:center;gap:10px;margin-bottom:6px}
    .brand img{height:28px;border-radius:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <form id="form" class="card" autocomplete="on">
      <div class="brand">
        <img src="https://drive.google.com/uc?export=view&id=1opE1H0_mWwguRjSaDlGPPVV3wN8Pn2jM" alt="logo">
        <div>
          <h1>Global Hillview, Enviro Helpdesk</h1>
          <div class="muted">Administrator sign in</div>
        </div>
      </div>

      <div class="row">
        <label for="u">Username</label>
        <input id="u" name="u" placeholder="admin" autofocus />
      </div>
      <div class="row">
        <label for="p">Password</label>
        <input id="p" name="p" type="password" />
      </div>
      <div class="row">
        <button id="btn" class="btn" type="submit">
          <span id="btnLabel">Sign in</span><span id="btnSpin" class="spinner" style="display:none"></span>
        </button>
      </div>
      <div id="err" class="err">Invalid credentials.</div>
      <div class="muted" style="margin-top:10px">Tip: use <b>admin</b> as username to get admin rights.</div>
    </form>
  </div>

  <script>
    const $ = sel => document.querySelector(sel);
    const form = $("#form"), btn=$("#btn"), spin=$("#btnSpin"), label=$("#btnLabel"), err=$("#err");
    function setLoading(on){ btn.disabled=!!on; spin.style.display=on?'inline-block':'none'; label.textContent=on?'Signing in…':'Sign in'; }
    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      err.style.display="none";
      setLoading(true);
      try{
        const username = $("#u").value.trim();
        const password = $("#p").value;
        const r = await fetch("/api?mode=api&op=login", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          credentials:"include",
          body: JSON.stringify({ username, password })
        });
        const j = await r.json();
        if(!j.ok){ throw new Error(j.message || "Login failed"); }
        // go home
        location.href = "/";
      }catch(ex){
        err.textContent = ex.message || "Login failed";
        err.style.display = "block";
      }finally{
        setLoading(false);
      }
    });
    // Enter to submit works because type="submit" and form listener above.
  </script>
</body>
</html>
