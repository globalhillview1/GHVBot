<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login | Helpdesk</title>
  <style>
    :root{--bg:#f7f9fc;--card:#ffffff;--muted:#6b7280;--text:#0f172a;--blue:#0d6efd;--blue-2:#0b5ed7;--border:#e5e7eb;--danger:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans";background:var(--bg);color:var(--text)}
    .wrap{min-height:100vh;display:grid;place-items:center;padding:24px}
    .card{width:100%;max-width:420px;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;box-shadow:0 10px 30px rgba(2,6,23,.06)}
    h1{margin:0 0 6px;font-size:22px}
    p{margin:0 0 18px;color:var(--muted)}
    label{display:block;margin:10px 0 6px;color:var(--muted);font-size:13px}
    input{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px}
    button{width:100%;margin-top:16px;padding:10px 12px;border-radius:10px;border:0;background:var(--blue);color:#fff;font-weight:700;cursor:pointer;transition:.2s}
    button.loading{background:var(--blue-2)}
    .err{display:none;margin-top:12px;padding:10px;border-radius:10px;background:var(--danger);color:#fff}
    .muted{color:var(--muted);font-size:12px;margin-top:10px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Sign in</h1>
      <p>Enter your credentials to access the Helpdesk Dashboard.</p>

      <label>Username</label>
      <input id="u" type="text" value="admin" autocomplete="username" />

      <label>Password</label>
      <input id="p" type="password" autocomplete="current-password" />

      <button id="btn">Sign in</button>
      <div id="err" class="err"></div>

      <div class="muted">Tip: use <b>admin</b> as username to get admin rights.</div>
    </div>
  </div>

  <script>
    const API = "/api";
    const $ = (s)=>document.querySelector(s);
    const btn = $("#btn"), err = $("#err");

    // Already logged in? go to dashboard.
    try { if(localStorage.getItem("session")) location.replace("/"); } catch(e){}

    function showErr(m){ err.textContent=m; err.style.display="block"; }

    btn.onclick = async () => {
      const u = $("#u").value.trim();
      const p = $("#p").value;
      if(!u || !p){ showErr("Missing credentials"); return; }

      err.style.display="none";
      btn.classList.add("loading");
      btn.textContent = "Signing in…";

      try{
        const r = await fetch(`${API}?mode=api&op=login`, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ username:u, password:p })
        });
        const j = await r.json();
        if(!j.ok) throw new Error(j.error || "Login failed");

        // Persist session + role (admin if username === 'admin')
        localStorage.setItem("session", j.token || `tok-${Date.now()}`);
        localStorage.setItem("role", u.toLowerCase()==="admin" ? "admin" : "user");

        btn.textContent = "Success ✓";
        setTimeout(()=> location.replace("/"), 700);
      }catch(e){
        showErr(e.message);
        btn.textContent = "Sign in";
      }finally{
        btn.classList.remove("loading");
      }
    };
  </script>
</body>
</html>
